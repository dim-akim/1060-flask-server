# 1060-flask-server
Пошаговое создание Web-сервера на Flask с использованием материалов от [HTML Academy][html-academy-link].  
Курс расчитан на слушателей, имеющих представление о:
* Базовом функционале языка Python версии 3
  * Типы данных и операции с ними
  * Ввод и вывод данных
  * Переменные
  * Условия
  * Циклы for и while
  * Установка и использование дополнительных модулей
* Функциях в Python
* Классах и объектах в Python
* Запросах и ответах протокола HTTP и работе браузера
* Основах HTML и CSS

## <a name="menu"></a> Оглавление
* [Шаг 1](#step-1) - Самый простой сервер
* [Шаг 2](#step-2) - Используем HTML-код

## ШАГ 0 - Подготовка

### Создать папку проекта
Для проекта нужна отдельная папка, где будут лежать все материалы, связанные с ним.  
Ее можно назвать `flask-server` или любым другим понятным именем.  
Созданную папку нужно открыть как проект в используемой IDE (например, [PyCharm][pycharm-download-link]):  
`Open Folder as PyCharm Project`

### Создать виртуальное окружение
В только что созданной и открытой папке нужно создать виртуальное окружение. Обычно его помещают в папку `venv`
в корне проекта (_**v**irtual **env**iroment_ - виртуальное окружение):  
```
flask-server  
|-- venv/
```

Это можно сделать двумя способами:
1. Средствами IDE (в PyCharm: *File* -> *Settings* -> *Project Interpreter* ->
   <img height="20" src=".\pic\settings-pic.png" width="20"/> -> *Add*)
2. Командой в системном терминале `python -m venv venv`

### Установить пакет Flask
Flask устанавливается тоже одним из двух способов:
1. Средствами IDE (в PyCharm: *File* -> *Settings* -> *Project Interpreter* ->
   <img height="20" src=".\pic\add-module-pic.png" width="20"/> -> *Flask* -> *Install Package*)
2. Командой в системном терминале `pip install flask`.


## <a name="step-1"></a> ШАГ 1 - Самый простой сервер
[К Оглавлению](#menu)
### Импортировать основной класс
Код будем писать в файле `server.py`.  
Из пакета flask нужно импортировать класс WCGI-приложения, на основе которого нужно будет создать новый объект:
```python
from flask import Flask
```

### Создать объект WCGI-приложения
`app` - стандартное имя для переменной основного приложения (от слова *application* - приложение). При создании объекта ему необходимо передать название
в качестве первого параметра. Обычно используется атрибут `__name__`:
```python from flask import Flask
app = Flask(__name__)
```

### Открыть URL на сервере
Чтобы пользователь мог через браузер или другое приложение обратиться по какому-то адресу на сервере, его надо открыть.
Для этого используется декоратор `@app.route()` (*route* - путь). В скобках указывается непосредственный адрес, по которому
можно будет обращаться. По умолчанию при обращении на любой сервер открывается адрес `/`:
```python
@app.route('/')
```

### Создать функцию представления для открытого пути
Чтобы пользователь мог получить какой-то ответ при запросе по открытому адресу, этот ответ должен быть сформирован
функцией. Она должна быть объявлена сразу под декоратором, открывающим путь (поэтому говорят, что функция
декорирована), и возвращать строку, которую потом сможет интерпретировать браузер:
```python
@app.route('/')
def hello():
    return 'Hello, World!'
```

### Сделать возможным запуск сервера
Сервер запускается с помощью метода `run` объекта `app`.  
Хорошим тоном считается вызывать этот метод только в том случае, если `server.py` запускается напрямую.
В этом случае его атрибут `__name__` (т.е. название скрипта) примет значение `__main__`, а не `server.py`,
как было бы при его импорте. Для того чтобы учесть эту ситуацию, есть специальная конструкция (в PyCharm ее можно
получить, просто набрав слово `main` и нажав **Enter**):
```python
if __name__ == '__main__':
    app.run()
```
Теперь, **если** запустить `server.py` напрямую, как **главный** файл, произойдет старт приложения,
а если импортировать его в другой проект, строчка `app.run()` выполнена не будет.

### Проверить работоспособность сервера
При запуске сервера (в PyCharm: сочетание клавиш *Ctrl* + *Shift* + *F10*) в консоли появится служебное сообщение и
адрес сервера, которое можно ввести в адресной строке браузера или просто щелкнуть по нему мышкой.

По умолчанию используется IP-адрес `127.0.0.1` и порт `5000` (говорят, что приложение слушает определенный адрес
и определенный порт). Этот адрес указывает компьютеру, что нужно обратиться к самому себе — т.е. зайти на этот адрес
получиться только с того компьютера, на котором запущено приложение.

Изменить эти настройки можно, указав дополнительные параметры `host` (строка) и `port` (целое число) методу `run`.
Например, следующий код сделает сервер видимым извне (т.е. к нему можно будет подключиться с другого компьютера):
```python
if __name__ == '__main__':
    app.run(host='0.0.0.0')
```
Открыв адрес сервера в браузере, можно увидеть фразу `Hello, World!`, которую возвращает наша функция `hello`.

### Структура проекта
```
flask-server  
|-- venv/
|-- server.py
```

## <a name="step-2"></a> ШАГ 2 - Используем HTML-код
[К Оглавлению](#menu)
### Создать новый URL
Обращаясь по определенному URL, браузер ожидает получить в ответ файл (или, как в случае нашего сервера, текст).
Если же по запрошенному адресу находится не файл, а каталог (по-другому папка), то web-сервер, обслуживающий сайт,
все равно должен будет вернуть браузеру какой-то файл, чтобы тот мог его отобразить пользователю. По умолчанию это будет
перечисление всего содержимого каталога - т.е. его индекс (*index* можно перевести как указатель или номер), что может
оказаться неудобным, некрасивым и даже небезопасным. Пример можно увидеть, пройдя по адресу <https://mirror.yandex.ru/>
(у каждой папки будет свой собственный индекс).

Чтобы не попадать в подобные ситуации, индексный файл стали переопределять - т.е. создавать свой собственный файл
`index.html` (расширение может быть другим, например, `htm` или `php`), в который помещали стартовую страницу каталога.  
Индексный файл корневой папки, таким образом, становился главной страницей всего сайта.
Любой современный web-сервер можно настроить так, чтобы в качестве файла по умолчанию он отдавал любой файл с любым
именем, но все равно исторически повелось, что главную страницу именуют словом `index`.

Мы откроем путь по этому адресу и создадим одноименную функцию представления:
```python
@app.route('/index')
def index():
    pass
```

### Вернуть HTML-код
Сайты в интернете написаны на языке HTML (*Hyper Text Markup Language* - язык разметки гипертекста), который указывает
браузеру, как именно отображать тот или иной элемент (чаще всего текст), с помощью специальных тегов,
заключенных в угловые скобки. Базовое знание языков HTML и CSS (он используется для стилизации страниц,
размеченных HTML) необходимо при создании web-серверов, поэтому рекомендуется пройти [небольшой курс][basic-html-css-link]
по знакомству с этими языками от HTML Academy.

Документ HTML всегда начинается с декларации его типа: `<!DOCTYPE html>` - это одиночный тег, который сообщает браузеру,
как именно надо интерпретировать полученный файл. Большинство других тегов работают в паре, состоящей из открывающего
и закрывающего тегов, в которые **оборачивается** содержимое (оно, в свою очередь, может быть завернуто в другие теги).
В частности, все содержимое документа HTML после декларации должно находиться внутри тега `html`. Оно должно состоять
из двух частей - блок `head`, куда помещается служебная информация для браузера (например, подключение стилей или
заголовок страницы, который отображается на вкладке в браузере) и блок `body`, где лежит непосредственно содержание
страницы для отображения пользователю в окне браузера.

Для того чтобы превратить обычный текст, возвращаемый функцией `hello`, в полноценный HTML-документ, нужно выстроить
базовую структуру документа тегами, внутрь тега `head` добавить заголовок, обернутый в тег `title`, а также обернуть фразу
`Hello, World!` в любой тег на ваш выбор (например, в тег заголовка первого уровня `h1`). Все это можно записать одной
строчкой, но гораздо удобнее видеть структуру вложенности тегов друг в друга:
```python
def index():
    return '''
    <!DOCTYPE html>
    <html>
      <head>
        <title>Flask Server</title>
      </head>
      <body>
        <h1>Hello, World!</h1>
      </body>
    </html>
    '''
```
Если добавить в блок body еще несколько тегов (например, `<h2>`, `<p>`, `<b>`, `<i>`), можно наглядно увидеть разницу.

### Запустить сервер
При добавлении новой функции или изменении старой необходимо в обязательном порядке заново запускать сервер и проверять
работоспособность всех открытых путей. Чтобы попасть на страницу `/index`, нужно зайти на свой сервер, а затем вручную
дописать этот адрес в адресной строке браузера. По умолчанию должно получиться `http://127.0.0.1:5000/index`.

[html-academy-link]: https://htmlacademy.ru/ "Обучение HTML и CSS"
[pycharm-download-link]: https://www.jetbrains.com/pycharm/download/ "Скачать PyCharm"
[basic-html-css-link]: https://htmlacademy.ru/courses/basic-html-css "Знакомство с HTML и CSS"
